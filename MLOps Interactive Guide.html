<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Warm & Minimalist Neutrals -->
    <!-- Application Structure Plan: The SPA is designed as a thematic, top-down dashboard. It starts with the "big picture" (the final architecture and the 5-stage journey) to provide immediate context. It then allows users to "zoom in" on key areas: the technical components, the security model, and the specific commands. This non-linear, explorable structure was chosen over a simple step-by-step guide to encourage active learning and allow students to revisit concepts based on their needs, reinforcing the relationships between different parts of the MLOps process rather than just the sequence. Navigation is handled by a sticky header for easy access to all sections. -->
    <!-- Visualization & Content Choices: 
        - Final Architecture: Goal: Organize. Method: HTML/CSS Diagram. Interaction: Hover effects on components. Justification: A static diagram is essential for context. Using HTML/CSS avoids SVG and allows for easy integration with the site's styling and future interactivity.
        - 5-Step Journey: Goal: Organize/Change. Method: HTML/CSS Process Flow. Interaction: Numbered steps with icons. Justification: Clearly visualizes the linear process of the lab in a digestible, non-technical format.
        - Resource Allocation: Goal: Compare. Method: Chart.js Bar Chart. Interaction: Tooltips on hover. Justification: A bar chart is the most effective way to compare the discrete values of the allocated resources (CPU, Memory, Instances). Chart.js is used for its Canvas rendering.
        - Security Model: Goal: Compare. Method: Side-by-side HTML/CSS cards. Interaction: N/A. Justification: Directly contrasts the two security approaches (secure vs. insecure) for maximum clarity. The visual distinction (colors, icons) is more impactful than a complex chart.
        - Key Commands: Goal: Organize/Inform. Method: Tabbed HTML/CSS component. Interaction: Clicking tabs to switch views. Justification: Organizes a large number of commands into logical, manageable groups (Build, Deploy, Secure), making them easy to find and reference. This is more user-friendly than a long, undifferentiated list.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>Interactive MLOps Lab Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F7F4; /* Warm neutral background */
        }
        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .nav-link {
            transition: color 0.2s;
        }
        .nav-link:hover {
            color: #A0522D; /* Subtle accent */
        }
        .flow-arrow {
            font-size: 2rem;
            color: #D3D3D3;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="sticky top-0 bg-[#F8F7F4]/80 backdrop-blur-md z-50 border-b border-gray-200">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-[#4A4A4A]">MLOps Interactive Guide</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#architecture" class="nav-link text-gray-600 px-3 py-2 rounded-md text-sm font-medium">Architecture</a>
                        <a href="#journey" class="nav-link text-gray-600 px-3 py-2 rounded-md text-sm font-medium">The Journey</a>
                        <a href="#deep-dive" class="nav-link text-gray-600 px-3 py-2 rounded-md text-sm font-medium">Deep Dive</a>
                        <a href="#commands" class="nav-link text-gray-600 px-3 py-2 rounded-md text-sm font-medium">Commands</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">

        <section id="intro" class="text-center mb-20">
            <h1 class="text-4xl md:text-5xl font-bold text-[#4A4A4A] tracking-tight">From Model to Microservice</h1>
            <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">An interactive exploration of the critical "last mile" in machine learning: deploying a TensorFlow model as a secure, scalable cloud service.</p>
        </section>

        <section id="architecture" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-[#4A4A4A] mb-4">Final Deployed Architecture</h2>
            <p class="text-center text-gray-600 max-w-4xl mx-auto mb-12">This application visualizes the complete, secure request/response flow. The process begins with an authenticated client and ends with a prediction from our model, all orchestrated by Google Cloud services. Each component plays a specific, vital role in the system.</p>
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-10 border border-gray-200">
                <div class="flex flex-col md:flex-row items-center justify-center space-y-6 md:space-y-0 md:space-x-6 text-center">
                    <div class="component-card flex flex-col items-center p-4" data-info="client">
                        <div class="text-5xl mb-2">üíª</div>
                        <h3 class="font-bold text-lg">Python Client</h3>
                        <p class="text-sm text-gray-500">`predict.py`</p>
                    </div>
                    <div class="flow-arrow md:hidden">‚ñº</div>
                    <div class="flow-arrow hidden md:block">‚ñ∂</div>
                    <div class="component-card flex flex-col items-center p-4" data-info="iam">
                        <div class="text-5xl mb-2">üîë</div>
                        <h3 class="font-bold text-lg">Google IAM</h3>
                        <p class="text-sm text-gray-500">Authentication</p>
                    </div>
                    <div class="flow-arrow md:hidden">‚ñº</div>
                    <div class="flow-arrow hidden md:block">‚ñ∂</div>
                    <div class="component-card flex flex-col items-center p-4" data-info="run">
                        <div class="text-5xl mb-2">‚òÅÔ∏è</div>
                        <h3 class="font-bold text-lg">Cloud Run</h3>
                        <p class="text-sm text-gray-500">Serverless Service</p>
                    </div>
                    <div class="flow-arrow md:hidden">‚ñº</div>
                    <div class="flow-arrow hidden md:block">‚ñ∂</div>
                    <div class="component-card flex flex-col items-center p-4" data-info="docker">
                        <div class="text-5xl mb-2">üê≥</div>
                        <h3 class="font-bold text-lg">Docker Container</h3>
                        <p class="text-sm text-gray-500">FastAPI + TF Model</p>
                    </div>
                </div>
                <div id="info-box" class="mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px]">
                    <p class="text-gray-700 text-center">Hover over a component to learn more about its role.</p>
                </div>
            </div>
        </section>

        <section id="journey" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-[#4A4A4A] mb-4">The 5-Stage Deployment Journey</h2>
            <p class="text-center text-gray-600 max-w-4xl mx-auto mb-12">The lab is structured as a five-part journey, taking a static model and progressively transforming it into a live, secure microservice. This path reflects a standard MLOps workflow from development to production.</p>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-0 md:gap-4 text-center">
                <div class="flex md:flex-col items-center">
                    <div class="bg-white rounded-lg shadow-md p-6 flex-grow w-full">
                        <div class="text-3xl font-bold text-[#A0522D]">1</div>
                        <div class="text-4xl my-3">üì¶</div>
                        <h3 class="font-bold text-lg">Package</h3>
                        <p class="text-sm text-gray-600">Combine the model, API code, and a `Dockerfile` blueprint.</p>
                    </div>
                    <div class="flow-arrow mx-4 md:my-4 md:mx-0">‚ñº</div>
                </div>
                <div class="flex md:flex-col items-center">
                    <div class="bg-white rounded-lg shadow-md p-6 flex-grow w-full">
                        <div class="text-3xl font-bold text-[#A0522D]">2</div>
                        <div class="text-4xl my-3">üèóÔ∏è</div>
                        <h3 class="font-bold text-lg">Build</h3>
                        <p class="text-sm text-gray-600">Use Cloud Build to create a container image in a secure registry.</p>
                    </div>
                     <div class="flow-arrow mx-4 md:my-4 md:mx-0">‚ñº</div>
                </div>
                <div class="flex md:flex-col items-center">
                    <div class="bg-white rounded-lg shadow-md p-6 flex-grow w-full">
                        <div class="text-3xl font-bold text-[#A0522D]">3</div>
                        <div class="text-4xl my-3">üöÄ</div>
                        <h3 class="font-bold text-lg">Deploy</h3>
                        <p class="text-sm text-gray-600">Launch the container on Cloud Run as a scalable microservice.</p>
                    </div>
                     <div class="flow-arrow mx-4 md:my-4 md:mx-0">‚ñº</div>
                </div>
                <div class="flex md:flex-col items-center">
                    <div class="bg-white rounded-lg shadow-md p-6 flex-grow w-full">
                        <div class="text-3xl font-bold text-[#A0522D]">4</div>
                        <div class="text-4xl my-3">üõ°Ô∏è</div>
                        <h3 class="font-bold text-lg">Secure</h3>
                        <p class="text-sm text-gray-600">Make the service private and grant invocation rights via IAM.</p>
                    </div>
                     <div class="flow-arrow mx-4 md:my-4 md:mx-0">‚ñº</div>
                </div>
                <div class="flex md:flex-col items-center">
                    <div class="bg-white rounded-lg shadow-md p-6 flex-grow w-full">
                        <div class="text-3xl font-bold text-[#A0522D]">5</div>
                        <div class="text-4xl my-3">üìû</div>
                        <h3 class="font-bold text-lg">Invoke</h3>
                        <p class="text-sm text-gray-600">An authenticated client calls the secure endpoint for a prediction.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="deep-dive" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-[#4A4A4A] mb-12">Configuration Deep Dive</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-center mb-4">Cloud Run Resource Allocation</h3>
                    <p class="text-center text-gray-600 mb-6">To ensure efficiency and control costs, specific resource limits are set during deployment. This chart visualizes the configuration for each container instance.</p>
                    <div class="chart-container">
                        <canvas id="resourceAllocationChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-center mb-4">Security Model: Private by Default</h3>
                    <p class="text-center text-gray-600 mb-6">The lab implements a robust security model using IAM, following the principle of least privilege. This is a critical concept in cloud engineering, preventing unauthorized access and potential cost overruns.</p>
                    <div class="space-y-4">
                        <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
                            <h4 class="font-bold text-red-800">Insecure: Public Endpoint</h4>
                            <p class="text-sm text-red-700">Allows unauthenticated access from anyone on the internet. Risky and costly.</p>
                        </div>
                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-green-800">Secure: Private Endpoint + IAM</h4>
                            <p class="text-sm text-green-700">Requires a valid Google-issued identity token for every call, restricting access to specific identities.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="commands" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-[#4A4A4A] mb-4">Key Command Reference</h2>
            <p class="text-center text-gray-600 max-w-4xl mx-auto mb-12">This lab uses the `gcloud` CLI to manage cloud resources. The commands are grouped by their function: building the container, deploying the service, and managing security permissions. Use these tabs to review the specific commands for each stage.</p>
            <div>
                <div class="mb-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-[#A0522D] text-[#A0522D]" data-target="build-panel">Build</button>
                        <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="deploy-panel">Deploy</button>
                        <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-target="secure-panel">Secure</button>
                    </nav>
                </div>
                <div id="command-panels">
                    <div id="build-panel" class="tab-panel">
                        <div class="bg-gray-800 rounded-lg p-4 font-mono text-sm text-gray-200">
                            <p class="text-green-400"># Submit the build job to Cloud Build</p>
                            <p>> gcloud builds submit --tag gcr.io/$(gcloud config get-value project)/tipper-api</p>
                        </div>
                    </div>
                    <div id="deploy-panel" class="tab-panel hidden">
                        <div class="bg-gray-800 rounded-lg p-4 font-mono text-sm text-gray-200">
                            <p class="text-green-400"># Deploy the container image to Cloud Run as a private service</p>
                            <p>> gcloud run deploy tipper-api \<br>  --image gcr.io/$(gcloud config get-value project)/tipper-api \<br>  --region us-central1 \<br>  --no-allow-unauthenticated \<br>  --memory 1Gi --cpu 1 --max-instances 2</p>
                        </div>
                    </div>
                    <div id="secure-panel" class="tab-panel hidden">
                        <div class="bg-gray-800 rounded-lg p-4 font-mono text-sm text-gray-200 space-y-4">
                            <div>
                                <p class="text-green-400"># 1. Create a service account for the client</p>
                                <p>> gcloud iam service-accounts create tipper-caller-sa --display-name "Service Account for Tipper API Client"</p>
                            </div>
                            <div>
                                <p class="text-green-400"># 2. Grant the service account permission to call the Cloud Run service</p>
                                <p>> gcloud run services add-iam-policy-binding tipper-api ... --role="roles/run.invoker"</p>
                            </div>
                            <div>
                                <p class="text-green-400"># 3. Generate a JSON key to authenticate as the service account</p>
                                <p>> gcloud iam service-accounts keys create tipper-caller-sa.json ...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <footer class="text-center mt-12 pb-8">
        <p class="text-gray-500">Interactive guide based on the MLOps Integration Sprint Lab.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const componentInfo = {
                client: {
                    title: 'Python Client (`predict.py`)',
                    text: 'Our local script that initiates the prediction request. It uses a Service Account Key to authenticate itself before sending data to the API.'
                },
                iam: {
                    title: 'Google IAM (Identity and Access Management)',
                    text: 'The client uses its key to get a temporary identity token from Google. This token proves the client has permission to call our specific Cloud Run service.'
                },
                run: {
                    title: 'Google Cloud Run Service',
                    text: 'A serverless platform that receives the request, verifies the identity token via IAM, and routes the request to an available container instance for processing.'
                },
                docker: {
                    title: 'Docker Container (FastAPI + Model)',
                    text: 'A self-contained package running our FastAPI web server. It loads the TensorFlow model, performs inference on the incoming data, and returns the prediction.'
                }
            };

            const infoBox = document.getElementById('info-box');
            const defaultInfo = infoBox.innerHTML;
            const componentCards = document.querySelectorAll('.component-card');

            componentCards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    const infoKey = card.dataset.info;
                    const info = componentInfo[infoKey];
                    infoBox.innerHTML = `<h4 class="font-bold text-lg text-[#4A4A4A]">${info.title}</h4><p class="text-gray-600 mt-2">${info.text}</p>`;
                });
                card.addEventListener('mouseleave', () => {
                    infoBox.innerHTML = defaultInfo;
                });
            });

            const tabs = document.querySelectorAll('.tab-btn');
            const panels = document.querySelectorAll('.tab-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.classList.remove('border-[#A0522D]', 'text-[#A0522D]');
                        t.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    tab.classList.add('border-[#A0522D]', 'text-[#A0522D]');
                    tab.classList.remove('border-transparent', 'text-gray-500');

                    const target = document.getElementById(tab.dataset.target);
                    panels.forEach(panel => {
                        panel.classList.add('hidden');
                    });
                    target.classList.remove('hidden');
                });
            });

            const resourceAllocationCtx = document.getElementById('resourceAllocationChart').getContext('2d');
            new Chart(resourceAllocationCtx, {
                type: 'bar',
                data: {
                    labels: ['CPU (Cores)', 'Memory (GiB)', 'Max Instances'],
                    datasets: [{
                        label: 'Allocated Resources',
                        data: [1, 1, 2],
                        backgroundColor: [
                            'rgba(160, 82, 45, 0.7)',
                            'rgba(210, 105, 30, 0.7)',
                            'rgba(244, 164, 96, 0.7)'
                        ],
                        borderColor: [
                            'rgb(160, 82, 45)',
                            'rgb(210, 105, 30)',
                            'rgb(244, 164, 96)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                           display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) { return tooltipItems[0].label; }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                color: '#4A4A4A',
                                stepSize: 1
                            }
                        },
                        y: {
                            ticks: {
                                color: '#4A4A4A'
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
